╔════════════════════════════════════════════════════════════════╗
║     Anki Feynman Learning 插件打包工具 - 快速参考卡片         ║
╚════════════════════════════════════════════════════════════════╝

┌────────────────────────────────────────────────────────────────┐
│ 🚀 快速开始（3步完成）                                         │
└────────────────────────────────────────────────────────────────┘

  第1步：安装依赖（仅首次）
  ┌──────────────────────────────────────┐
  │ 双击运行：安装依赖.bat                │
  └──────────────────────────────────────┘

  第2步：打包插件
  ┌──────────────────────────────────────┐
  │ 双击运行：打包插件.bat                │
  └──────────────────────────────────────┘

  第3步：分发文件
  ┌──────────────────────────────────────┐
  │ 在 dist 目录找到 .ankiaddon 文件      │
  │ 发送给其他用户                        │
  └──────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│ 📋 命令行版本                                                   │
└────────────────────────────────────────────────────────────────┘

  安装依赖：
  pip install -r requirements.txt -t vendor --upgrade

  打包插件：
  python build_addon.py

┌────────────────────────────────────────────────────────────────┐
│ ✅ 自动处理的事项                                               │
└────────────────────────────────────────────────────────────────┘

  ✓ 清除 API keys（config.json）
  ✓ 排除 meta.json（用户配置）
  ✓ 排除开发文件（__pycache__, .pyc, .git 等）
  ✓ 包含所有依赖库（vendor 目录）
  ✓ 生成带时间戳的文件名
  ✓ 自动压缩为 .ankiaddon 格式

┌────────────────────────────────────────────────────────────────┐
│ 📦 打包内容                                                     │
└────────────────────────────────────────────────────────────────┘

  包含：
  • 所有 Python 源代码
  • GUI 界面文件
  • 配置文件（已清理敏感信息）
  • 文档和提示词
  • vendor 目录（所有依赖）

  排除：
  • API keys 和用户配置
  • 开发和测试文件
  • 临时文件和日志
  • Git 和 IDE 配置

┌────────────────────────────────────────────────────────────────┐
│ 🔍 验证打包结果                                                 │
└────────────────────────────────────────────────────────────────┘

  检查文件大小：约 1.7 MB
  检查文件位置：dist/anki_feynman_YYYYMMDD_HHMMSS.ankiaddon

  验证 API key 已清除：
  python -c "import zipfile, json; \
    z = zipfile.ZipFile('dist/anki_feynman_*.ankiaddon'); \
    data = json.loads(z.read('config.json')); \
    print('API Keys:', data['ai_service']['openai']['api_key'])"
  
  输出应该是空字符串

┌────────────────────────────────────────────────────────────────┐
│ ⚠️ 常见问题                                                     │
└────────────────────────────────────────────────────────────────┘

  问题：ModuleNotFoundError: No module named 'typing_extensions'
  解决：运行 "安装依赖.bat" 然后重新打包

  问题：打包文件太大
  解决：正常，包含所有依赖库约 1.7 MB

  问题：朋友安装后无法运行
  解决：
  1. 检查是否安装了所有依赖
  2. 重新打包
  3. 查看 Anki 错误日志

┌────────────────────────────────────────────────────────────────┐
│ 📝 用户安装步骤（给朋友的说明）                                 │
└────────────────────────────────────────────────────────────────┘

  1. 打开 Anki
  2. 工具 → 插件
  3. 从文件安装
  4. 选择 .ankiaddon 文件
  5. 重启 Anki
  6. 在设置中配置 API key

┌────────────────────────────────────────────────────────────────┐
│ 📚 详细文档                                                     │
└────────────────────────────────────────────────────────────────┘

  README_打包工具.md     - 完整使用指南
  打包说明.md            - 详细功能说明
  打包工具文件清单.txt   - 文件列表

┌────────────────────────────────────────────────────────────────┐
│ 🛠️ 故障排除                                                     │
└────────────────────────────────────────────────────────────────┘

  Python 未找到：
  → 安装 Python 3.7+

  pip 安装失败：
  → python -m pip install --upgrade pip
  → 使用国内镜像源

  打包失败：
  → 关闭 Anki
  → 检查磁盘空间
  → 查看错误信息

╔════════════════════════════════════════════════════════════════╗
║ 提示：首次使用前必须先运行"安装依赖.bat"！                     ║
╚════════════════════════════════════════════════════════════════╝

