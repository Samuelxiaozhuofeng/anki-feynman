# 自定义模板卡片类型功能说明

## 概述

自定义模板现在支持三种卡片类型：
- **选择题 (Multiple Choice)**
- **知识卡 (Knowledge Card)**
- **问答题 (Essay Question)**

## 功能特点

### 1. 卡片类型选择
在创建或编辑模板时，可以选择模板生成的卡片类型。每种类型有不同的：
- JSON 输出格式
- 系统提示词
- 验证规则

### 2. 简化的模板变量
- **移除**: `{num_questions}` 变量（问题数量由外部UI控制）
- **保留**: `{content}` 变量（学习内容）

### 3. 自动示例更新
选择不同的卡片类型时，示例内容会自动更新，帮助用户理解如何编写该类型的提示词。

## 使用方法

### 创建选择题模板

1. 点击"添加模板"
2. 选择卡片类型：**选择题**
3. 输入模板内容示例：

```
请基于以下内容设计选择题，确保每个题目覆盖不同的概念，
选项要有足够的干扰性，使学生必须真正理解概念才能选对。
每个题目都应包含一个简短的解释。

内容：
{content}
```

**生成的JSON格式**：
```json
{
    "questions": [
        {
            "question": "问题内容",
            "options": ["A. 选项1", "B. 选项2", "C. 选项3", "D. 选项4"],
            "correct_answer": "A",
            "explanation": "解释",
            "source_content": "原文段落"
        }
    ]
}
```

### 创建知识卡模板

1. 点击"添加模板"
2. 选择卡片类型：**知识卡**
3. 输入模板内容示例：

```
请基于以下内容生成知识卡，每张卡片应该：
1. 问题简洁明确，聚焦单一知识点
2. 答案详细准确，便于理解和记忆
3. 包含必要的上下文信息，帮助建立知识联系
4. 遵循SuperMemo原则，确保卡片质量

内容：
{content}
```

**生成的JSON格式**：
```json
{
    "cards": [
        {
            "question": "问题内容",
            "answer": "答案内容",
            "context": "上下文信息"
        }
    ]
}
```

### 创建问答题模板

1. 点击"添加模板"
2. 选择卡片类型：**问答题**
3. 输入模板内容示例：

```
请基于以下内容设计开放性问答题，要求：
1. 问题能引发深度思考，而非简单复述
2. 提供详细的参考答案
3. 列出3-5个关键要点
4. 标注相关的原文段落作为依据

内容：
{content}
```

**生成的JSON格式**：
```json
{
    "questions": [
        {
            "question": "问题内容",
            "reference_answer": "参考答案",
            "key_points": ["要点1", "要点2", "要点3"],
            "source_content": "原文段落"
        }
    ]
}
```

## 向后兼容性

- 旧版本创建的模板会自动迁移，默认设置为"选择题"类型
- 迁移在插件初始化时自动完成
- 不会影响现有模板的使用

## 技术实现

### 模板数据结构
```json
{
    "id": "uuid",
    "name": "模板名称",
    "content": "提示词内容",
    "card_type": "choice|knowledge_card|essay"
}
```

### 生成流程
1. 用户选择自定义模板
2. 系统读取模板的 `card_type` 字段
3. 根据类型调用对应的生成方法：
   - `_generate_custom_choice()` - 选择题
   - `_generate_custom_knowledge_card()` - 知识卡
   - `_generate_custom_essay()` - 问答题
4. 使用对应的验证器验证返回的JSON

## 注意事项

1. **问题数量**: 在主界面的"问题数量"输入框中设置，无需在模板中指定
2. **变量使用**: 只需使用 `{content}` 变量，系统会自动替换为学习内容
3. **JSON格式**: 无需在模板中指定返回格式，系统会自动添加相应的系统提示词
4. **模板测试**: 建议先用少量内容测试模板是否能正确生成卡片

## 常见问题

**Q: 可以在一个模板中混合多种卡片类型吗？**
A: 不可以。每个模板只能生成一种类型的卡片。如需不同类型，请创建多个模板。

**Q: 旧模板会受影响吗？**
A: 不会。旧模板会自动标记为"选择题"类型，功能保持不变。

**Q: 如何修改现有模板的卡片类型？**
A: 在模板管理器中选择模板，点击"编辑"，然后修改"卡片类型"下拉框。

