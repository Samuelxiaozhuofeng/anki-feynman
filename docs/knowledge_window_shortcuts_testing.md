# Knowledge Window 快捷键功能测试指南

## 测试前准备

1. 确保 Anki 已安装并运行
2. 确保插件已正确安装
3. 准备一些测试用的知识卡片数据

## 测试用例

### 测试用例 1: 左右箭头键导航

**目的**: 验证左右箭头键可以正常切换卡片

**步骤**:
1. 打开 Knowledge Window（至少有 3 张卡片）
2. 当前应该在第 1 张卡片
3. 按右箭头键 (→)
4. 验证：应该跳转到第 2 张卡片
5. 再按右箭头键 (→)
6. 验证：应该跳转到第 3 张卡片
7. 按左箭头键 (←)
8. 验证：应该返回到第 2 张卡片
9. 按左箭头键 (←)
10. 验证：应该返回到第 1 张卡片

**预期结果**: 
- 左右箭头键可以正常切换卡片
- 在第一张时按左箭头无效
- 在最后一张时按右箭头无效

---

### 测试用例 2: 空格键添加卡片

**目的**: 验证空格键可以添加卡片并自动跳转

**步骤**:
1. 打开 Knowledge Window
2. 在第 1 张卡片上按空格键
3. 验证：
   - 显示 tooltip 提示 "知识卡已添加到Anki"（1秒后消失）
   - 自动跳转到第 2 张卡片
   - 不弹出模态对话框
4. 按左箭头键返回第 1 张卡片
5. 验证：按钮文本显示为 "✓ 已添加"

**预期结果**:
- 空格键成功添加卡片
- 使用 tooltip 提示，不阻塞操作
- 自动跳转到下一张卡片
- 已添加的卡片按钮状态改变

---

### 测试用例 3: 重复添加检测

**目的**: 验证重复添加卡片时的提示

**步骤**:
1. 打开 Knowledge Window
2. 在第 1 张卡片上按空格键（首次添加）
3. 验证：成功添加并跳转到第 2 张
4. 按左箭头键返回第 1 张卡片
5. 再次按空格键
6. 验证：
   - 显示 tooltip "此卡片已添加"
   - 自动跳转到第 2 张卡片
   - 不会重复添加到 Anki

**预期结果**:
- 检测到重复添加
- 显示相应提示
- 仍然执行自动跳转

---

### 测试用例 4: 按钮点击行为

**目的**: 验证点击按钮的行为与快捷键不同

**步骤**:
1. 打开 Knowledge Window
2. 点击 "添加到Anki" 按钮
3. 验证：
   - 显示 tooltip 提示
   - **不**自动跳转到下一张
   - 仍停留在当前卡片

**预期结果**:
- 按钮点击不自动跳转
- 快捷键和按钮行为有区别

---

### 测试用例 5: 卡片状态显示

**目的**: 验证卡片状态正确显示

**步骤**:
1. 打开 Knowledge Window（至少 3 张卡片）
2. 在第 1 张卡片，验证按钮文本为 "添加到Anki"
3. 按空格键添加
4. 按左箭头返回第 1 张，验证按钮文本为 "✓ 已添加"
5. 按右箭头到第 2 张，验证按钮文本为 "添加到Anki"
6. 按空格键添加第 2 张
7. 按左箭头返回第 1 张，验证按钮文本仍为 "✓ 已添加"
8. 按右箭头到第 2 张，验证按钮文本为 "✓ 已添加"
9. 按右箭头到第 3 张，验证按钮文本为 "添加到Anki"

**预期结果**:
- 按钮状态正确反映卡片是否已添加
- 切换卡片时状态正确更新

---

### 测试用例 6: 追问面板不受影响

**目的**: 验证快捷键不影响追问面板的输入

**步骤**:
1. 打开 Knowledge Window
2. 点击追问输入框
3. 输入文本（包含空格）
4. 验证：输入的空格正常显示，不触发添加卡片功能

**预期结果**:
- 在追问输入框中，空格键正常输入空格
- 不触发添加卡片快捷键

---

### 测试用例 7: 最后一张卡片处理

**目的**: 验证在最后一张卡片时的行为

**步骤**:
1. 打开 Knowledge Window
2. 使用右箭头键导航到最后一张卡片
3. 按空格键添加
4. 验证：
   - 卡片成功添加
   - 显示 tooltip 提示
   - 不跳转（因为已经是最后一张）

**预期结果**:
- 最后一张卡片添加成功
- 不会因为无法跳转而报错

---

### 测试用例 8: 多语言支持

**目的**: 验证中英文界面下的提示信息

**步骤**:
1. 在中文界面下测试
   - 验证提示为 "知识卡已添加到Anki"
   - 验证按钮状态为 "✓ 已添加"
   - 验证重复添加提示为 "此卡片已添加"
2. 切换到英文界面
   - 验证提示为 "Knowledge card has been added to Anki"
   - 验证按钮状态为 "✓ Added"
   - 验证重复添加提示为 "This card has already been added"

**预期结果**:
- 所有提示信息正确国际化

---

## 性能测试

### 测试用例 9: 快速连续操作

**目的**: 验证快速连续按键的稳定性

**步骤**:
1. 打开 Knowledge Window（至少 10 张卡片）
2. 快速连续按空格键 10 次
3. 验证：
   - 所有卡片正确添加
   - 没有重复添加
   - 没有跳过卡片
   - 界面响应正常

**预期结果**:
- 快速操作稳定可靠
- 没有竞态条件问题

---

## 回归测试

### 测试用例 10: 原有功能不受影响

**目的**: 验证新功能不影响原有功能

**步骤**:
1. 测试 "转换为填空题" 按钮功能
2. 测试追问功能
3. 测试预览功能
4. 测试从追问历史创建卡片功能

**预期结果**:
- 所有原有功能正常工作

---

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
Anki 版本: ____________________
插件版本: ____________________

| 测试用例 | 通过 | 失败 | 备注 |
|---------|------|------|------|
| 1. 左右箭头键导航 | ☐ | ☐ | |
| 2. 空格键添加卡片 | ☐ | ☐ | |
| 3. 重复添加检测 | ☐ | ☐ | |
| 4. 按钮点击行为 | ☐ | ☐ | |
| 5. 卡片状态显示 | ☐ | ☐ | |
| 6. 追问面板不受影响 | ☐ | ☐ | |
| 7. 最后一张卡片处理 | ☐ | ☐ | |
| 8. 多语言支持 | ☐ | ☐ | |
| 9. 快速连续操作 | ☐ | ☐ | |
| 10. 原有功能不受影响 | ☐ | ☐ | |

总体评价: ____________________
发现的问题: ____________________
```

